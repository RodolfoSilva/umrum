{% extends "admin-base.html" %}

{% block content %}
  <div class="page-wrap">

    <div class="row">
      <div class="col-lg-4">
        <div class="panel panel-info">
          <div class="panel-heading">
            <div class="row">
              <div class="col-xs-6">
                <i class="fa fa-chart-o fa-5x"></i>
              </div>
              <div class="col-xs-6 text-right">
                <p class="announcement-heading">{{ data.currentVisits }}</p>
                <p class="announcement-text">Current visitors</p>
              </div>
            </div>
          </div>
          <a href="//{{host}}" target="_blank">
            <div class="panel-footer announcement-bottom">
              <div class="row">
                <div class="col-xs-6">
                  {{ host }}
                </div>
                <div class="col-xs-6 text-right">
                  <i class="fa fa-arrow-circle-right"></i>
                </div>
              </div>
            </div>
          </a>
        </div>
      </div>
    </div><!-- /.row -->


    <div class="row">
      <div class="col-lg-12">
        <div class="panel panel-primary">
          <div class="panel-heading">
            <h3 class="panel-title"><i class="fa fa-file-text-o"></i> Top Pages</h3>
          </div>
          <div class="panel-body">
            <div class="table-responsive">
              <table class="table table-bordered table-hover table-striped">
                <thead>
                  <tr>
                    <th>Page</th>
                    <th>Views</th>
                  </tr>
                </thead>
                <tbody class="toppages">
                  {% for item in data.topPages %}
                  <tr>
                    <td>{{ item[0] }}</td>
                    <td>{{ item[1] }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div><!-- /.row -->

  </div><!-- /#page-wrapper -->
{% endblock %}

{% block scripts %}
  {{super()}}
  <script src="/socket.io/socket.io.js"></script>
  <script>
    var socket = io.connect('ws://'+window.location.host);
    socket.on("{{ hostId }}", function (msg) {
      if (!msg) return;
      if (msg.currentVisits) {
        $('.announcement-heading').text(msg.currentVisits);
      }
      if (msg.topPages) {
        $('.toppages').html(msg.topPages.map(function(page){
          return "<tr><td>"+page[0]+"</td><td>"+page[1]+"</td></tr>";
        }).join(''));
      }
    });
  </script>
{% endblock %}
